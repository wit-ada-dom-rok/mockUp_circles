
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com">
    <link href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">
    
    <link
        href="https://acxeu-eu-pmg-prod-css-download.s3.dualstack.eu-central-1.amazonaws.com/public/preview/cssForPreview.css"
        rel="stylesheet">
    <style>
        a { text-decoration: none; }
        body { max-width: 1230px; margin: 0 auto; }

        .progress-circle { position: relative; }
        svg.circle-svg { width: 225px; height: 225px; }

        .progress-bottom-span {
            margin-top: 45px;
            text-align: center;
            color: white;
            font-size: 12px;
            line-height: 18px;
            bottom: 0;
        }

        .bg {
            fill: none;
            stroke: #081dbb;
            stroke-width: 3.8;
            box-shadow: inset 40px 93px 152px #081dbb;
        }
        .visible .progress {
            fill: none;
            stroke: white;
            stroke-width: 3.8;
            stroke-linecap: round;
            stroke-dashoffset: 100;
            animation: fillProgress 2s ease-out forwards;
        }

        @keyframes fillProgress {
            0% { stroke-dasharray: 100; }
            100% { stroke-dashoffset: 0; }
        }

        @keyframes stepAnimation {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        .progress_taskNumbers {
            text-align: center;
            color: white;
            font-weight: bold;
            top: 58%;
            left: 50%;
            transform: translate(-50%, -50%);
            position: absolute;
            font-size: 10px;
            line-height: 14px !important;
        }

        .percentage {
            fill: #fff;
            color: #fff;
            font-family: Arial, sans-serif;
            font-weight: 800;
            font-size: 3.2em;
            text-anchor: middle;
            dominant-baseline: middle;
            position: absolute;
            top: 45%;
            left: 53%;
            transform: translate(-50%, -50%);
        }

        .progress-circles_container {
            margin: 0;
            max-width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 10px 40px;
            background: linear-gradient(to bottom, #081dbb, #084adf, #081dbb);
            border-radius: 15px;
            background-repeat: no-repeat;
        }

        .progress-disabled { display: none; }

        .progress-circles_circles h3 {
            color: #fff;
            text-align: center;
        }

        .progress-circles_text { margin-bottom: 10px; }

        .progress-circle-cta {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 219px;
            height: 44px;
            font-size: 14px;
            line-height: 20px;
            color: #000;
            background: #fff;
            border-radius: 15px 15px 0 15px;
            margin-top: 20px;
        }

        .progress-circles_header {
            font-size: 29px;
            line-height: 35px;
            margin: 0;
            text-align: center;
            color: #fff;
        }

        .progress-circles_copy {
            font-size: 16px;
            line-height: 22px;
            margin: 0;
            text-align: center;
            color: #fff;
        }

        .progress-circles_circles {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 100px;
            flex-wrap: wrap;
            width: 100%;
        }

        .progress-circles_container.visible .progress-circle {
            animation: stepAnimation 0.5s linear forwards 0s;
        }
        .progress-circles_container:not(.visible) .progress-circle {
            opacity: 0;
        }

        @keyframes leftAppear {
            0% { opacity: 0; transform: translate(-150px, 0); }
            100% { opacity: 1; transform: translate(0, 0); }
        }
        @keyframes rightAppear {
            0% { opacity: 0; transform: translate(150px, 0); }
            100% { opacity: 1; transform: translate(0, 0); }
        }

        @media screen and (max-width: 1024px) {
            .progress-circles_circles { gap: 50px; }
        }

        @media screen and (max-width: 600px) {
            .progress_taskNumbers { position: static; transform: unset; }

            .progress_percentageAndTaskNumbers {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                flex: 1;
            }

            .progress-circles_container { padding: 20px 15px 40px; }

            .progress-circles_header,
            .steps-text {
                font-size: 18px;
                line-height: 23px;
            }

            .progress-circles_copy {
                font-size: 14px;
                line-height: 20px;
                margin-top: 20px;
            }

            .parallax_900pixels { display: none; }

            .percentageAndCTA_container {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 90vw;
            }

            .progress-circle-cta {
                flex: 1;
                margin-top: 0;
                margin-right: 17px;
            }

            .percentage {
                font-weight: 800;
                font-size: 12vw;
                line-height: 55px;
                position: static;
                text-align: center;
                transform: unset;
            }

            .circles-mobile { display: none; }
        }
        .button_level{
            background: transparent;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .is-active, .button_level:hover{
            background: white;
            color: #081dbb;
        }
    </style>
</head>

<body>
    <div class="progress-circles_container visible" id="dashboard">
        <div style="display:flex; gap:30px; margin-bottom:16px;">
            <button class="button_level is-active" id="adventurer_btn">ADVENTURER</button>
            <button class="button_level" id="explorer_btn">EXPLORER</button>
        </div>

        <h2 class="progress-circles_header">Your Progress</h2>
        <p class="progress-circles_copy">Tap to switch persona: Adventurer / Explorer</p>

        <div class="progress-circles_circles" id="circles"></div>
    </div>

    <script>
        (function () {
            // === Twoje dane (możesz zmienić na swoje) ===
            const db = {
                Adventurer: {
                    "Courses Assigned": "32",
                    "Courses Accomplished": "28",
                    "Courses in progress": "0",
                    "Completion Rate": "87.5",
                    "Badges Achieved": "18",
                    "Badges to be Achieved": "3"
                },
                Explorer: {
                    "Courses Assigned": "10",
                    "Courses Accomplished": "9",
                    "Courses in progress": "0",
                    "Completion Rate": "90",
                    "Badges Achieved": "0",
                    "Badges to be Achieved": "-"
                }
            };

            // Definicja dwóch kół dla każdej persony
            const circleDefs = [
                {
                    key: 'courses',
                    title: 'COURSES',
                    cta: { href: 'https://www.pmiopen.de/s/aktionen-und-news', label: 'Aktionen entdecken' }
                },
                {
                    key: 'badges',
                    title: 'BADGES',
                    cta: { href: 'https://www.pmiopen.de/s/trainings', label: 'Training starten' }
                }
            ];

            const duration = 2000; // czas animacji licznika %
            const dashboard = document.getElementById('dashboard');
            const container = document.getElementById('circles');
            const adventurerBtn = document.getElementById('adventurer_btn');
            const explorerBtn = document.getElementById('explorer_btn');

            // Helpers
            const clamp = (x, min, max) => Math.max(min, Math.min(max, x));
            const toNum = v => {
                const n = parseFloat(v);
                return Number.isFinite(n) ? n : NaN;
            };

            function computeCoursePercent(item) {
                const raw = toNum(item["Completion Rate"]);
                if (Number.isFinite(raw)) return clamp(Math.round(raw), 0, 100);
                const assigned = toNum(item["Courses Assigned"]) || 0;
                const done = toNum(item["Courses Accomplished"]) || 0;
                if (assigned <= 0) return 0;
                return clamp(Math.round((done / assigned) * 100), 0, 100);
            }

            function computeBadgePercent(item) {
                const achieved = toNum(item["Badges Achieved"]) || 0;
                const toAchieve = toNum(item["Badges to be Achieved"]); // może być NaN gdy "-"
                if (!Number.isFinite(toAchieve)) {
                    // brak pełnych danych o totalu – pokaż 0% (konserwatywnie)
                    return 0;
                }
                const total = achieved + toAchieve;
                if (total <= 0) return 0;
                return clamp(Math.round((achieved / total) * 100), 0, 100);
            }

            function animateCounter(el, targetValue) {
                const startTime = performance.now();
                const easeOutCubic = t => 1 - Math.pow(1 - t, 3);
                function update(now) {
                    const t = Math.min(1, (now - startTime) / duration);
                    const value = Math.round(targetValue * easeOutCubic(t));
                    el.textContent = value + '%';
                    if (t < 1) requestAnimationFrame(update);
                }
                requestAnimationFrame(update);
            }

            // Budowa pojedynczego kółka (DOM) + konfiguracja animacji i tekstów
            function createCircleDOM(idx, title, percent, countsText, cta) {
                const wrap = document.createElement('div');
                wrap.className = 'progress-circle';

                const h3 = document.createElement('h3');
                h3.textContent = title;

                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('class', 'circle-svg circles-mobile');
                svg.setAttribute('viewBox', '0 0 36 36');

                const bg = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                bg.setAttribute('class', 'bg');
                bg.setAttribute('d', `M18 2.0845
                    a 15.9155 15.9155 0 0 1 0 31.831
                    a 15.9155 15.9155 0 0 1 0 -31.831`);

                const progress = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                progress.setAttribute('class', `progress circle${idx}`);
                progress.setAttribute('d', `M18 2.0845
                    a 15.9155 15.9155 0 0 1 0 31.831
                    a 15.9155 15.9155 0 0 1 0 -31.831`);
                // Ustaw docelowy łuk (CSS animuje dashoffset)
                progress.style.strokeDasharray = `${percent} 100`;
                progress.style.strokeDashoffset = 100;

                const percentageAndCTA = document.createElement('div');
                percentageAndCTA.className = 'percentageAndCTA_container';

                const pctAndTasks = document.createElement('div');
                pctAndTasks.className = 'progress_percentageAndTaskNumbers';

                const pctSpan = document.createElement('span');
                pctSpan.className = `percentage percentage${idx}`;
                pctSpan.setAttribute('data-target', String(percent));
                pctSpan.textContent = '0%'; // start od 0 – JS podbije do celu

                const tasksSpan = document.createElement('span');
                tasksSpan.className = 'progress_taskNumbers';
                tasksSpan.innerHTML = countsText;

                // CTA
                const link = document.createElement('a');
                link.className = 'progress-circle-cta';
                link.href = cta?.href || '#';
                link.textContent = cta?.label || 'Learn more';
                link.style.visibility = 'hidden'; // zostawiam jak w Twoim oryginale; zmień na 'visible' jeśli ma być wyświetlane

                // Składanie DOM
                pctAndTasks.appendChild(pctSpan);
                pctAndTasks.appendChild(tasksSpan);

                percentageAndCTA.appendChild(pctAndTasks);
                percentageAndCTA.appendChild(link);

                svg.appendChild(bg);
                svg.appendChild(progress);

                wrap.appendChild(h3);
                wrap.appendChild(svg);
                wrap.appendChild(percentageAndCTA);

                // uruchom animację licznika
                requestAnimationFrame(() => animateCounter(pctSpan, percent));

                return wrap;
            }

            function formatCountsCourses(item) {
                const done = item["Courses Accomplished"] ?? "0";
                const assigned = item["Courses Assigned"] ?? "0";
                return `<span class="progress_taskCompletedX">${done}</span> out of <span class="progress_taskToCompleteX">${assigned}</span> courses have been completed!`;
            }
            function formatCountsBadges(item) {
                const achieved = item["Badges Achieved"] ?? "0";
                const toAchieveNum = toNum(item["Badges to be Achieved"]);
                if (!Number.isFinite(toAchieveNum)) {
                    // brak totalu
                    return `<span class="progress_taskCompletedX">${achieved}</span> badges have been achieved!`;
                }
                const total = (toNum(achieved) || 0) + toAchieveNum;
                return `<span class="progress_taskCompletedX">${achieved}</span> out of <span class="progress_taskToCompleteX">${total}</span> badges have been achieved!`;
            }

            function renderPersona(personaKey) {
                const data = db[personaKey];
                if (!data) return;

                // restart CSS animacji łuku: zdejmij i dodaj .visible
                dashboard.classList.remove('visible');
                container.innerHTML = '';

                // Kursy
                const pctCourses = computeCoursePercent(data);
                const countsCourses = formatCountsCourses(data);
                const circle1 = createCircleDOM(
                    1,
                    circleDefs[0].title,
                    pctCourses,
                    countsCourses,
                    circleDefs[0].cta
                );
                container.appendChild(circle1);

                // Odznaki
                const pctBadges = computeBadgePercent(data);
                const countsBadges = formatCountsBadges(data);
                const circle2 = createCircleDOM(
                    2,
                    circleDefs[1].title,
                    pctBadges,
                    countsBadges,
                    circleDefs[1].cta
                );
                container.appendChild(circle2);

                // force reflow i przywróć .visible, by odpalić animacje CSS na .progress
                void dashboard.offsetWidth;
                dashboard.classList.add('visible');
            }

            // Zdarzenia
            
            adventurerBtn.addEventListener('click', () => {
            adventurerBtn.classList.add('is-active');
            explorerBtn.classList.remove('is-active');
            renderPersona('Adventurer');
            });

            explorerBtn.addEventListener('click', () => {
            explorerBtn.classList.add('is-active');
            adventurerBtn.classList.remove('is-active');
            renderPersona('Explorer');
            });


            // Start
            renderPersona('Adventurer');
        })();
    </script>
</body>

</html>
